You are generating Ruby DSL code for an autonomous agent in a Kubernetes operator.

{{if .ErrorContext}}
## IMPORTANT: Self-Healing Synthesis - Attempt {{.AttemptNumber}}

The previous code synthesis encountered errors. Please analyze the errors below and generate CORRECTED code.

### Previous Synthesis Failures

{{if .ErrorContext.ValidationErrors}}
**Validation Errors** (detected during code generation):
{{range .ErrorContext.ValidationErrors}}
- {{.}}
{{end}}
{{end}}

{{if .ErrorContext.RuntimeErrors}}
**Runtime Errors** (detected during execution):
{{range .ErrorContext.RuntimeErrors}}
- Time: {{.Timestamp}}
- Type: {{.ErrorType}}
- Message: {{.ErrorMessage}}
{{if .StackTrace}}
- Stack Trace:
{{range .StackTrace}}
  {{.}}
{{end}}
{{end}}
- Exit Code: {{.ContainerExitCode}}
{{end}}
{{end}}

{{if .ErrorContext.LastCrashLog}}
**Last Container Logs** (before crash):
```
{{.ErrorContext.LastCrashLog}}
```
{{end}}

### Your Task

1. Carefully analyze each error above
2. Identify the root cause of the failure
3. Generate CORRECTED Ruby DSL code that addresses ALL errors
4. Ensure the code:
   - Fixes the specific errors mentioned
   - Uses only available tools: {{.ToolsList}}
   - Uses only available models: {{.ModelsList}}
   - Follows the Language Operator DSL syntax exactly
   - Does NOT use any dangerous Ruby methods (system, eval, etc.)

This is attempt {{.AttemptNumber}} of {{.MaxAttempts}}. The user is counting on you to get it right!

{{if .LastKnownGoodCode}}
### Last Known Working Code (for reference)
```ruby
{{.LastKnownGoodCode}}
```
{{end}}

{{else}}
## Agent Synthesis Request
{{end}}

**User Instructions:**
{{.Instructions}}

**Available Tools:**
{{.ToolsList}}

**Available Models:**
{{.ModelsList}}

**Agent Name:** {{.AgentName}}

**Detected Temporal Intent:** {{.TemporalIntent}}

**Runtime Context:**
- All agent messages and output are automatically logged to stdout
- Agents have access to a workspace directory for file operations
- LLM responses are captured and available in agent execution context

Generate Ruby DSL code using this exact format (wrapped in triple-backticks with ruby):

```ruby
require 'language_operator'

agent "{{.AgentName}}" do
  description "Brief description extracted from instructions"
{{.PersonaSection}}{{.ScheduleSection}}
  # Extract objectives from instructions
  objectives [
    "First objective",
    "Second objective"
  ]

  # REQUIRED: Define workflow with at least one step
  workflow do
    # Use tools when available
    step :step_name, tool: "tool_name", params: {key: "value"}

    # Or use execute blocks for custom Ruby code (simple logging, calculations, etc.)
    step :custom_step do
      execute do
        puts "Custom output from Ruby code"
        { result: "done" }
      end
    end

    # Chain steps with dependencies if needed
    step :another_step, depends_on: :step_name
  end

{{.ConstraintsSection}}

  # Output configuration (if workspace enabled)
  output do
    workspace "results/output.txt"
  end
end
```

**Rules:**
1. Generate ONLY the Ruby code within triple-backticks, no explanations before or after
{{.ScheduleRules}}
5. Break down instructions into clear, actionable objectives
6. REQUIRED: Always include a workflow block with at least one step (even for simple single-action agents)
7. For simple tasks (logging, calculations), use a single step with an execute block containing Ruby code
8. For complex tasks, use multiple steps with tools or execute blocks
9. Use available tools in workflow steps when tools are provided
10. Use the agent name: "{{.AgentName}}"

Generate the code now:
